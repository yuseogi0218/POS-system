# POS ì •ì‚° ì‹œìŠ¤í…œ 
### í”„ë¡œì íŠ¸ ê¸°íš ë¬¸ì„œ ğŸ—‚ â†’ [ë§í¬](https://yuseogi0218.notion.site/POS-17e5a0fb7695816fa036d16d9dc9f609)
<img width="711" alt="image" src="https://github.com/user-attachments/assets/1bb8ade1-0c61-473b-9ce9-91119aaa6044" />

### ìŒì‹ì ì„ ëŒ€ìƒìœ¼ë¡œ í•œ POS(Point Of Sale) ì‹œìŠ¤í…œ ë° ì •ì‚° ì‹œìŠ¤í…œ
- ìƒì  ì£¼ì¸ê³¼ ê³ ê°ì„ ìœ„í•œ ìƒí’ˆ ì£¼ë¬¸ ë° ê±°ë˜ ì™„ë£Œ(ê°€ìƒ ê²°ì œ) ê¸°ëŠ¥ ì œê³µ 
- ìƒì  ì£¼ì¸ì„ ìœ„í•œ ìƒí’ˆ íŒë§¤ í†µê³„ ë° ê±°ë˜ ì •ì‚°ì„ ìœ„í•œ **ë°°ì¹˜ í”„ë¡œê·¸ë¨ ë° í™•ì¥ì„±ì„ ê³ ë ¤í•œ ì„¤ê³„ ì ìš©**
---

**ğŸ‘¨â€ğŸ’»1ì¸ í”„ë¡œì íŠ¸**

**í”„ë¡œì íŠ¸ ìˆ˜í–‰ ê¸°ê°„** : 2024.12.18 ~ 2025.01.18

**Backend**

![Java](https://img.shields.io/badge/-Java-333333?style=flat&logo=Java)
![springboot](https://img.shields.io/badge/-springboot-333333?style=flat&logo=springboot)
![springdatajpa](https://img.shields.io/badge/-springdataJPA-333333?style=flat&logo=spring)
![springcloud](https://img.shields.io/badge/-springcloud-333333?style=flat&logo=iCloud&logoColor=6DB33F)
![springbatch](https://img.shields.io/badge/-springbatch-333333?style=flat&logo=Buffer&logoColor=6DB33F)
![springsecurity](https://img.shields.io/badge/-springsecurity-333333?style=flat&logo=springsecurity)
![JWT](https://img.shields.io/badge/-JWT-333333?style=flat&logo=jsonwebtokens)
![MySQL](https://img.shields.io/badge/-MySQL-333333?style=flat&logo=mysql)
![Redis](https://img.shields.io/badge/-Redis-333333?style=flat&logo=Redis)
![Kafka](https://img.shields.io/badge/-Kafka-333333?style=flat&logo=apachekafka)

**DevOps & Testing**

![Git](https://img.shields.io/badge/-Git-333333?style=flat&logo=git)
![GitHub](https://img.shields.io/badge/-GitHub-333333?style=flat&logo=github)
![Docker](https://img.shields.io/badge/-Docker-333333?style=flat&logo=docker)
![Pushgateway](https://img.shields.io/badge/-Pushgateway-333333?style=flat&logo=prometheus&logoColor=2480E6)
![Prometheus](https://img.shields.io/badge/-Prometheus-333333?style=flat&logo=prometheus)
![Grafana](https://img.shields.io/badge/-Grafana-333333?style=flat&logo=grafana)
![Postman](https://img.shields.io/badge/-Postman-333333?style=flat&logo=postman)
![AWS-EC2](https://img.shields.io/badge/-AmazonEC2-333333?style=flat&logo=AmazonEC2)
![AWS-RDS](https://img.shields.io/badge/-AmazonRDS-333333?style=flat&logo=AmazonRDS)
![JUnit](https://img.shields.io/badge/-JUnit5-333333?style=flat&logo=JUnit5)

---

## Micro Service Architecture & ERD âš™ï¸
> ì´ë¯¸ì§€ í´ë¦­ ì‹œ, í™•ëŒ€í•˜ì—¬ ìì„¸íˆ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

|Micro Service Architecture|ERD|
|---|---|
|![Micro Service Architecture](https://github.com/user-attachments/assets/d9b71c0c-35da-4237-8d3a-8a0a02e557f7)|![ERD](https://github.com/user-attachments/assets/db3acfb8-2c9c-432f-81a1-5614ab57b4d2)|

---

## ì£¼ìš” ë¹„ì¦ˆë‹ˆìŠ¤ êµ¬í˜„ ê¸°ëŠ¥ ğŸ“¦
- User Domain
  - ìƒì  ì£¼ì¸ ì†Œì…œ(ì¹´ì¹´ì˜¤) íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ / ë¡œê·¸ì•„ì›ƒ
- Store Domain
  - ìƒì  ì£¼ì¸ì— ì˜í•œ íŒë§¤ ìƒí’ˆ ê´€ë¦¬(CRUD)
  - ìƒí’ˆ íŒë§¤ í†µê³„ ë° ì •ì‚° ë°ì´í„° ì¡°íšŒ
- Trade Domain
  - ì£¼ë¬¸ìš© íƒœë¸”ë¦¿ ê¸°ê¸°ì— ì˜í•œ ìƒí’ˆ ì£¼ë¬¸
  - í˜„ì¬ ì§„í–‰ì¤‘ì¸ ê±°ë˜ì˜ ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ
  - ìƒì  ì£¼ì¸ì— ì˜í•œ í˜„ì¬ ì§„í–‰ì¤‘ì¸ ê±°ë˜ì˜ ì£¼ë¬¸ ë‚´ì—­ì— ëŒ€í•œ ì¼ê´„ (í˜„ê¸ˆ/ì¹´ë“œ) ê²°ì œ
- Batch Server
  - 1ì¼, 1ì£¼(ì›”ìš”ì¼ ~ ì¼ìš”ì¼), 1ë‹¬ ë‹¨ìœ„ì˜ ìƒí’ˆ íŒë§¤ í†µê³„ ë°ì´í„° ìƒì„±
  - 1ì¼, 1ë‹¬(ìƒì ë³„ ì •ì‚°ì¼)ì˜ ì •ì‚° ë°ì´í„° ìƒì„±

---

## ê¸°ìˆ ì  ê²½í—˜ ğŸ’»
- **MSA ê¸°ë°˜**ìœ¼ë¡œ ê° ì„œë¹„ìŠ¤ì˜ í™•ì¥ì„± ì œê³µ ë° ë…ë¦½ì ì¸ ìš´ì˜ ì§€ì› 
- **Eureka** ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ì™€ **API Gateway** ë¥¼ í™œìš©í•œ ë™ì  ì„œë¹„ìŠ¤ ë“±ë¡ ë° ë¼ìš°íŒ… êµ¬í˜„
- **JWT ì¸ì¦** í•„í„°ë¥¼ API Gateway ì— ì ìš©í•˜ì—¬ í†µí•© ì¸ì¦ ê¸°ëŠ¥ êµ¬í˜„
- **OpenFeign** ì„ í†µí•œ ë‚´ãƒ»ì™¸ë¶€ ëª¨ë“ˆ í†µì‹  êµ¬í˜„
- **Choreography Saga íŒ¨í„´** ì ìš©ì„ í†µí•œ ë¶„ì‚° í™˜ê²½ì—ì„œì˜ íŠ¸ëœì­ì…˜ ì œì–´ (With Kafka)
- **Prometheus With Pushgateway & Grafana** ë¥¼ í†µí•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ë°°ì¹˜ í”„ë¡œê·¸ë¨ ëª¨ë‹ˆí„°ë§ êµ¬ì„±
- **Docker Compose** ë¡œ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ì˜ í†µí•© ê°œë°œ/ë°°í¬ í™˜ê²½ êµ¬ì„±
- **JUnit**ì„ í™œìš©í•œ í†µí•© ë° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± - xx% Line Coverage ë‹¬ì„±

---
## Spring Batch ë¥¼ í™œìš©í•œ ë°°ì¹˜ í”„ë¡œê·¸ë¨ ë° ì„œë¹„ìŠ¤ í™•ì¥ì„ ê³ ë ¤í•œ ì„¤ê³„ ì ìš©
> **í”„ë¡œì íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í™˜ê²½**
> - ì„œë²„ ìì› - AWS EC2 â†’ t2.micro ì¸ìŠ¤í„´ìŠ¤ (Free-Tier), ê°€ìƒ CPU 1 core, ë©”ëª¨ë¦¬ 1GiB
> - ë°ì´í„°ë² ì´ìŠ¤ ìì› - AWS RDS â†’ db.t4g.micro ì¸ìŠ¤í„´ìŠ¤ (Free-Tier), ê°€ìƒ CPU 2 core, ë©”ëª¨ë¦¬ 1GiB
> 
> *ë³´í†µ vCPU(ê°€ìƒ CPU) ëŠ” ë¬¼ë¦¬ CPU ì‚¬ì–‘ì˜ ì ˆë°˜ ì •ë„ì˜ ì„±ëŠ¥ì„ ê°€ì§„ë‹¤.*

### Ver 1. GROUP BY + SUM ì¿¼ë¦¬ë¥¼ í™œìš©í•œ ë°ì´í„° ì¡°íšŒ ì‹œ, ì§‘ê³„ ìˆ˜í–‰
- Spring Batch ë¥¼ í™œìš©í•œ ë°°ì¹˜ í”„ë¡œê·¸ë¨ ì‘ì„±
  - ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ì— ì í•©í•œ Chunk ê¸°ë°˜ ì„¤ê³„ ì ìš©
  - JdbcPagingItemReader ì™€ JdbcBatchItemWriter ë¥¼ í™œìš©í•œ ë°°ì¹˜ í”„ë¡œê·¸ë¨ êµ¬ì„±


- ì•½ 280ë§Œê±´ì˜ ê±°ë˜ ë°ì´í„°ì— ëŒ€í•´ì„œ 1000ê±´ ê²°ê³¼ ë°ì´í„° ì§‘ê³„ ì‹œ, 30ì´ˆ ì´ë‚´ë¡œ ë°°ì¹˜ í”„ë¡œê·¸ë¨ ìˆ˜í–‰ ì™„ë£Œ
- ì•½ 100ë§Œê±´ì˜ ê±°ë˜ ë°ì´í„°ì— ëŒ€í•´ì„œ 100ê±´ ê²°ê³¼ ë°ì´í„° ì§‘ê³„ ì‹œ, 5ì´ˆ ì´ë‚´ë¡œ ë°°ì¹˜ í”„ë¡œê·¸ë¨ ìˆ˜í–‰ ì™„ë£Œ

> ì˜ˆë¥¼ ë“¤ì–´ 50ë§Œê°œì˜ ìƒí’ˆì— ëŒ€í•œ íŒë§¤ ë°ì´í„° 1,000ë§Œê°œê°€ ìˆë‹¤ê³  í•˜ì. ì´ë•Œ ì§‘ê³„ ê²°ê³¼ë¡œ 50ë§Œê°œì˜ ìƒí’ˆ íŒë§¤ í†µê³„ ë°ì´í„°ê°€ ìƒì„±ë˜ê²Œ ëœë‹¤.

![Architecture](https://github.com/user-attachments/assets/5eb9c3fd-7e20-44e0-9930-fba6973f36be)

### GROUP BY + SUM ì¿¼ë¦¬ë¥¼ í†µí•œ ì§‘ê³„ ìˆ˜í–‰ ì‹œ, í•œê³„ì 
- ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‹œì ë¶€í„° ì§‘ê³„ê°€ ì™„ë£Œë˜ì–´ ì²˜ë¦¬ ë° ì €ì¥ì´ ê°„ë‹¨í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆìŒ


- í•˜ì§€ë§Œ ì§‘ê³„ ì—°ì‚°ì´ ì¿¼ë¦¬ì— ì˜ì¡´ì ì´ê¸° ë•Œë¬¸ì— ì¿¼ë¦¬ì˜ ì‹¤í–‰ ê³„íšì´ ë³µì¡í•´ì§€ê³ , ì´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ì„±ëŠ¥ ì €í•˜ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŒ
  - íŠ¹íˆ, GROUP BY + SUM ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§‘ê³„ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì˜¤ëŠ” ItemReaderëŠ” ë°°ì¹˜ ì‘ì—… ì „ì²´ ì„±ëŠ¥ì˜ 90% ì´ìƒì„ ì¢Œìš°í•¨
- ë˜í•œ ì„œë¹„ìŠ¤ì˜ ë„ë©”ì¸(ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ) ì¦ê°€ ë° ë°ì´í„° ëˆ„ì ìœ¼ë¡œ ì¸í•´ ì„œë¹„ìŠ¤ì˜ ê·œëª¨ê°€ ì»¤ì§€ë©´, ì§‘ê³„ ì¿¼ë¦¬ ì‘ì„± ë° ìœ ì§€ë³´ìˆ˜ì— ë” ë§ì€ ë¦¬ì†ŒìŠ¤ê°€ í•„ìš”í•¨ 

### Ver 2. ì„œë¹„ìŠ¤ ê·œëª¨ ì¦ê°€ ë° í™•ì¥ì„±ì„ ê³ ë ¤í•œ ë°°ì¹˜ í”„ë¡œê·¸ë¨ ì„¤ê³„ ì ìš© â†’ ğŸ”— [ìì„¸íˆ ë³´ê¸°](https://yuseogi0218.notion.site/Batch-Server-17e5a0fb7695815dba38f77c84460b1f)
![New Architecture](https://github.com/user-attachments/assets/e75c6491-e747-4258-aadf-9a7c8d9e30d4)

- Databaseì—ì„œ GROUP BY + SUM ì¿¼ë¦¬ë¥¼ í†µí•´ì„œ ìˆ˜í–‰í•˜ë˜ ì§‘ê³„ ì—­í• ì„, Redis ê°€ ëŒ€ì‹  ìˆ˜í–‰í•˜ëŠ” ì„¤ê³„
  - ì¿¼ë¦¬ ì‘ì„± ë° ìœ ì§€ë³´ìˆ˜ì— ëŒ€í•œ ë¦¬ì†ŒìŠ¤ ì ˆì•½ê³¼ ì¿¼ë¦¬ ì‹¤í–‰ ê³„íšì˜ ë‹¨ìˆœí™”ë¥¼ í†µí•´ ëŒ€ê·œëª¨ ë°ì´í„° ì²˜ë¦¬ ì‹œ, ì„±ëŠ¥ í–¥ìƒ ê¸°ëŒ€
  - Redis ì˜ O(1) ì˜ ì‹œê°„ë³µì¡ë„ë¥¼ ë³´ì¥í•˜ëŠ” hash í•¨ìˆ˜ì™€ ë‹¤ìˆ˜ì˜ ì—°ì‚°ì„ ë¬¶ì–´ì„œ Redis ì—ê²Œ ìš”ì²­í•˜ëŠ” Redis Pipeline ì„ í†µí•œ ì„±ëŠ¥ ì €í•˜ ë°©ì§€


- ì•½ 280ë§Œê±´ì˜ ê±°ë˜ ë°ì´í„°ì— ëŒ€í•´ì„œ 1000ê±´ ê²°ê³¼ ë°ì´í„° ì§‘ê³„ ì‹œ, 4ë¶„ 20ì´ˆ ì´ë‚´ë¡œ ë°°ì¹˜ í”„ë¡œê·¸ë¨ ìˆ˜í–‰ ì™„ë£Œ
- ì•½ 100ë§Œê±´ì˜ ê±°ë˜ ë°ì´í„°ì— ëŒ€í•´ì„œ 100ê±´ ê²°ê³¼ ë°ì´í„° ì§‘ê³„ ì‹œ, 45ì´ˆ ì´ë‚´ë¡œ ë°°ì¹˜ í”„ë¡œê·¸ë¨ ìˆ˜í–‰ ì™„ë£Œ
  - ê¸°ì¡´ 18ë¶„ ì´ë‚´ë¡œ ìˆ˜í–‰ë˜ë˜ ì‘ì—… â†’ ë‚´ì¥ í•¨ìˆ˜ ì œê±°ì™€ ì¸ë±ìŠ¤ ì¶”ê°€ë“±ì˜ ì¿¼ë¦¬ íŠœë‹ì„ í†µí•´ 45ì´ˆë¡œ ë‹¨ì¶• 
    
    **(95.94% ì„±ëŠ¥ ê°œì„ )**

### â­ï¸ í”„ë¡œì íŠ¸ Insight ğŸ’«
Ver 1 : GROUP BY + SUM ì¿¼ë¦¬ë¥¼ í™œìš©í•œ ì§‘ê³„ ìˆ˜í–‰, Ver 2 : Redis ë¥¼ í™œìš©í•œ ì§‘ê³„ ìˆ˜í–‰
- ë°ì´í„°ê°€ ì‘ê³  ì¿¼ë¦¬ê°€ ë‹¨ìˆœí•œ ì„œë¹„ìŠ¤ì˜ ì´ˆê¸° ë‹¨ê³„ì¼ ê²½ìš°ì—ëŠ”, Ver 1ì´ ë” ì í•©í•¨
  - í•˜ì§€ë§Œ Ver 1 ì˜ GROUP BY + SUMê³¼ ê°™ì€ ì¿¼ë¦¬ëŠ” ì—°ì‚°ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´ì ì´ë©° ì„±ëŠ¥ ì €í•˜ ë° ë‚œí•´í•œ ì¿¼ë¦¬ íŠœë‹ì˜ ì›ì¸ì´ ë  ìˆ˜ ìˆìŒ


- ì„œë¹„ìŠ¤ì˜ ë„ë©”ì¸(ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ) ì¦ê°€ ë° ë°ì´í„° ëˆ„ì ìœ¼ë¡œ ì¸í•´ ì„œë¹„ìŠ¤ì˜ ê·œëª¨ê°€ ì»¤ì§€ë©´, Ver 2ê°€ ë” ì í•©í•œ ë°©ë²•
  - ë°ì´í„°ëŸ‰ì´ ì¦ê°€í•˜ê³  ì¿¼ë¦¬ê°€ ë³µì¡í•´ì§ˆìˆ˜ë¡ Ver 2ê°€ ì‹œê°„ ë° ë¦¬ì†ŒìŠ¤ ì ˆì•½ ì¸¡ë©´ì—ì„œ ìœ ë¦¬í•¨
  - ë˜í•œ, ì¿¼ë¦¬ê°€ ë‹¨ìˆœí•´ì ¸ì„œ ì½”ë“œ ì‘ì„± ë° ìœ ì§€ë³´ìˆ˜ë„ ë”ìš± ê°„ê²°í•´ì§ˆ ìˆ˜ ìˆìŒ


- ê²°ë¡ ì ìœ¼ë¡œ, ì§‘ê³„ ì—°ì‚°ì„ ì–´ë””ì—ì„œ ìˆ˜í–‰í• ì§€ëŠ” ìœ ì§€ë³´ìˆ˜ì„±ê³¼ ì„±ëŠ¥ì˜ ê· í˜•ì´ ì¤‘ìš”í•œ ìš”ì†Œ
  - ì„±ëŠ¥ ê¸°ì¤€ì ì„ ì¶©ì¡±í•˜ëŠ” ë²”ìœ„ ë‚´ì—ì„œ, ì„œë¹„ìŠ¤ íŠ¹ì„±ê³¼ í–¥í›„ í™•ì¥ì„±ì„ ê³ ë ¤í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì— ì í•©í•œ ì„¤ê³„ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ ìµœì„ ì˜ ì„ íƒ

---

## í”„ë¡œì íŠ¸ ë¬¸ì„œí™” ì§„í–‰ ğŸ—’ï¸ â†’ [ë§í¬](https://yuseogi0218.notion.site/pos-settlement-system)
- í”„ë¡œì íŠ¸ ì§„í–‰ ì‹œ, ë‚´ìš© ì •ë¦¬ ë° ì§„í–‰ì‚¬í•­ íŠ¸ë˜í‚¹ì„ ìœ„í•´ ë¬¸ì„œí™” ì‘ì—… ìˆ˜í–‰
- í•­í•´99 ì·¨ì—… ë¦¬ë¶€íŠ¸ ì½”ìŠ¤ 6ê¸° - ìš°ìˆ˜ í”„ë¡œì íŠ¸ ê¸°ë¡ ì„ ì •


- **ê¸°ëŠ¥ ëª…ì„¸ì„œ** â†’ [ë§í¬](https://yuseogi0218.notion.site/17e5a0fb769581f099eef1587bab2d7b)
- **API ë¬¸ì„œ**ï¸ â†’ [ë§í¬](https://yuseogi0218.notion.site/API-17e5a0fb76958142b2c2f62329f4eb8d)
- **Error Code** â†’ [ë§í¬](https://yuseogi0218.notion.site/Error-Code-17e5a0fb769581abbf2afbe4da2bf628)
- **ê¸°ìˆ ì  ì˜ì‚¬ ê²°ì •ï¸** â†’ [ë§í¬](https://yuseogi0218.notion.site/17e5a0fb769581f39c33c981122bc2e0)

---

## í”„ë¡œì íŠ¸ ì‹¤í–‰ ë°©ë²• âŒ¨ï¸
1. Github Repository Clone
2. Kakao ê°œë°œì ì„¼í„° App ë“±ë¡ ë° ì„¤ì • For OAuth Login 
3. [.env](/.env) íŒŒì¼ ìˆ˜ì • - í™˜ê²½ ë³€ìˆ˜ ì„¤ì • 
4. docker compose file ì‹¤í–‰
    ```shell
    docker compose -f docker-compose.infrastructure.yml -p pos up -d
    docker compose -f docker-compose.application.yml -p pos up -d
    docker compose -f docker-compose.monitoring.yml -p pos up -d
    ```
5. database ì ‘ì† ë° schema.sql ì˜ DDL ì‹¤í–‰
    - service-db (:3307)
      - [user-domain](user-service/src/main/resources/database/schema.sql), [store-domain](store-service/src/main/resources/database/schema.sql), [trade-domain](trade-service/src/main/resources/database/schema.sql), [batch-server](batch-server/src/main/resources/database/schema.sql)
    - meta-db (:3308)
      - [batch-server](batch-server/src/main/resources/database/meta-schema.sql)
---

**í”„ë¡œì íŠ¸ ì°¸ê³ **
> - [[ìš°ì•„í•œ í˜•ì œë“¤] ì •ì‚° ì‹œìŠ¤í…œ íŒ€ì„ ì†Œê°œí•©ë‹ˆë‹¤.](https://techblog.woowahan.com/2701/)
> - [[TossPayments] API ë¬¸ì„œ - ì •ì‚°](https://docs.tosspayments.com/reference#%EC%A0%95%EC%82%B0)
> - [[if kakao 2022] Batch Performanceë¥¼ ê³ ë ¤í•œ ìµœì„ ì˜ Aggregation](https://tech.kakaopay.com/post/ifkakao2022-batch-performance-aggregation/)
